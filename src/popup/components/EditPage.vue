<template>
  <div
    id="edit"
    class="flex flex-col"
  >
    <header class="w-full p-4 flex justify-between items-center bg-white border-b border-gray-200">
      <button
        title="delete bookmark"
        :disabled="!urlBookmarkState"
        class="p-1 text-red-400 hover:text-white bg-white hover:bg-red-400 rounded"
        :class="{ 'opacity-10': !urlBookmarkState }"
        @click="deleteBookmarkHandler"
      >
        <svg
          class="w-5 h-5"
          viewBox="0 0 50 50"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M41.5 11H34.0007V9.5C33.9994 8.30694 33.5249 7.16312 32.6813 6.3195C31.8376 5.47588 30.6938 5.00134 29.5007 5H20.5007C19.3077 5.00134 18.1639 5.47588 17.3202 6.3195C16.4766 7.16312 16.0021 8.30694 16.0007 9.5V11H8.5C8.10217 11 7.72064 11.158 7.43934 11.4393C7.15804 11.7206 7 12.1022 7 12.5C7 12.8978 7.15804 13.2794 7.43934 13.5607C7.72064 13.842 8.10217 14 8.5 14H10V41C10.0009 41.7954 10.3173 42.5579 10.8797 43.1203C11.4421 43.6827 12.2046 43.9991 13 44H37C37.7954 43.9991 38.5579 43.6827 39.1203 43.1203C39.6827 42.5579 39.9991 41.7954 40 41V14H41.5C41.8978 14 42.2794 13.842 42.5607 13.5607C42.842 13.2794 43 12.8978 43 12.5C43 12.1022 42.842 11.7206 42.5607 11.4393C42.2794 11.158 41.8978 11 41.5 11ZM19.0007 9.5C19.0012 9.10233 19.1594 8.72109 19.4406 8.43989C19.7218 8.15869 20.1031 8.0005 20.5007 8H29.5007C29.8984 8.0005 30.2797 8.15869 30.5609 8.43989C30.8421 8.72109 31.0003 9.10233 31.0007 9.5V11H19.0007V9.5ZM37 41H13V14H37V41ZM22.0007 21.5V33.5C22.0007 33.8978 21.8427 34.2794 21.5614 34.5607C21.2801 34.842 20.8986 35 20.5007 35C20.1029 35 19.7214 34.842 19.4401 34.5607C19.1588 34.2794 19.0007 33.8978 19.0007 33.5V21.5C19.0007 21.1022 19.1588 20.7206 19.4401 20.4393C19.7214 20.158 20.1029 20 20.5007 20C20.8986 20 21.2801 20.158 21.5614 20.4393C21.8427 20.7206 22.0007 21.1022 22.0007 21.5ZM31.0007 21.5V33.5C31.0007 33.8978 30.8427 34.2794 30.5614 34.5607C30.2801 34.842 29.8986 35 29.5007 35C29.1029 35 28.7214 34.842 28.4401 34.5607C28.1588 34.2794 28.0007 33.8978 28.0007 33.5V21.5C28.0007 21.1022 28.1588 20.7206 28.4401 20.4393C28.7214 20.158 29.1029 20 29.5007 20C29.8986 20 30.2801 20.158 30.5614 20.4393C30.8427 20.7206 31.0007 21.1022 31.0007 21.5Z"
          />
        </svg>
      </button>
      <div class="flex items-center space-x-0.5">
        <div class="p-1 flex justify-center items-center">
          <img
            class="bookmark-favicon w-5 h-5 rounded"
            :src="favicon"
            alt="bookmark favicon"
          >
        </div>
        <h1 class="text-xl font-bold text-gray-800">
          收藏书签
        </h1>
      </div>
      <button
        title="more menu button"
        class="btn"
      >
        <svg
          class="w-5 h-5"
          viewBox="0 0 50 50"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M27.6875 37.3438C27.6875 37.8073 27.55 38.2604 27.2925 38.6459C27.035 39.0313 26.6689 39.3317 26.2407 39.5091C25.8124 39.6865 25.3412 39.7329 24.8865 39.6425C24.4319 39.552 24.0142 39.3288 23.6865 39.001C23.3587 38.6733 23.1355 38.2556 23.045 37.801C22.9546 37.3463 23.001 36.8751 23.1784 36.4468C23.3558 36.0186 23.6562 35.6525 24.0416 35.395C24.4271 35.1375 24.8802 35 25.3438 35C25.9651 35.0007 26.5609 35.2479 27.0002 35.6873C27.4396 36.1266 27.6868 36.7224 27.6875 37.3438ZM25.3438 14.6875C25.8073 14.6875 26.2604 14.55 26.6459 14.2925C27.0313 14.035 27.3317 13.6689 27.5091 13.2407C27.6865 12.8124 27.7329 12.3412 27.6425 11.8865C27.552 11.4319 27.3288 11.0142 27.001 10.6865C26.6733 10.3587 26.2556 10.1355 25.801 10.045C25.3464 9.9546 24.8751 10.001 24.4468 10.1784C24.0186 10.3558 23.6525 10.6562 23.395 11.0416C23.1375 11.4271 23 11.8802 23 12.3438C23.0007 12.9651 23.2479 13.5609 23.6873 14.0002C24.1267 14.4396 24.7224 14.6868 25.3438 14.6875ZM25.3438 22.5C24.8802 22.5 24.4271 22.6375 24.0416 22.895C23.6562 23.1525 23.3558 23.5186 23.1784 23.9468C23.001 24.3751 22.9546 24.8464 23.045 25.301C23.1355 25.7556 23.3587 26.1733 23.6865 26.501C24.0142 26.8288 24.4319 27.052 24.8865 27.1425C25.3412 27.2329 25.8124 27.1865 26.2407 27.0091C26.6689 26.8317 27.035 26.5313 27.2925 26.1459C27.55 25.7604 27.6875 25.3073 27.6875 24.8438C27.6868 24.2224 27.4396 23.6267 27.0002 23.1873C26.5609 22.7479 25.9651 22.5007 25.3438 22.5Z"
          />
        </svg>
      </button>
    </header>

    <div class="main flex-grow overflow-y-auto">
      <div class="w-full px-4 py-2 space-y-4">
        <div class="framework">
          <div class="space-y-2">
            <label
              for="title"
              class="label-style"
            >
              <svg
                class="w-5 h-5"
                viewBox="0 0 50 50"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M35.8889 5H14.1111C13.2863 5.00093 12.4955 5.32994 11.9122 5.91485C11.329 6.49977 11.0009 7.29281 11 8.12V42.44C11 42.7185 11.0743 42.9919 11.2153 43.2318C11.3562 43.4717 11.5586 43.6694 11.8015 43.8044C12.0443 43.9394 12.3188 44.0068 12.5964 43.9995C12.874 43.9921 13.1445 43.9105 13.38 43.7629L24.9986 36.4796L36.62 43.7629C36.8555 43.9105 37.126 43.9921 37.4036 43.9995C37.6812 44.0068 37.9557 43.9394 38.1985 43.8044C38.4414 43.6694 38.6438 43.4717 38.7847 43.2318C38.9257 42.9919 39 42.7185 39 42.44V8.12C38.9991 7.29281 38.671 6.49977 38.0878 5.91485C37.5045 5.32994 36.7137 5.00093 35.8889 5ZM35.8889 39.6256L25.8229 33.3171C25.5757 33.1622 25.29 33.08 24.9984 33.08C24.7069 33.08 24.4212 33.1622 24.174 33.3171L14.1111 39.6254V8.12H35.8889V39.6256Z"
                />
              </svg>
              <span class="text-sm">名称</span>
            </label>
            <input
              id="title"
              v-model="title"
              class="input-style"
              type="text"
              name="title"
              placeholder="请输入书签名称"
            >
          </div>
          <div class="space-y-2">
            <label
              for="url"
              class="label-style"
            >
              <svg
                class="w-5 h-5"
                viewBox="0 0 50 50"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M17.0008 23.5707H33.0003C33.354 23.5707 33.6931 23.7212 33.9431 23.9891C34.1932 24.257 34.3336 24.6204 34.3336 24.9993C34.3336 25.3782 34.1932 25.7415 33.9431 26.0094C33.6931 26.2773 33.354 26.4279 33.0003 26.4279H17.0008C16.6472 26.4279 16.3081 26.2773 16.058 26.0094C15.808 25.7415 15.6675 25.3782 15.6675 24.9993C15.6675 24.6204 15.808 24.257 16.058 23.9891C16.3081 23.7212 16.6472 23.5707 17.0008 23.5707ZM20.9995 32.1429H14.3331C12.565 32.1429 10.8694 31.3903 9.61915 30.0508C8.36895 28.7112 7.66659 26.8944 7.66659 25C7.66659 23.1056 8.36895 21.2888 9.61915 19.9492C10.8694 18.6097 12.565 17.8571 14.3331 17.8571H20.9995C21.3531 17.8571 21.6923 17.7066 21.9423 17.4387C22.1924 17.1708 22.3328 16.8075 22.3328 16.4286C22.3328 16.0497 22.1924 15.6863 21.9423 15.4184C21.6923 15.1505 21.3531 15 20.9995 15H14.3331C11.8578 15 9.48388 16.0536 7.73359 17.9289C5.9833 19.8043 5 22.3478 5 25C5 27.6522 5.9833 30.1957 7.73359 32.0711C9.48388 33.9464 11.8578 35 14.3331 35H20.9995C21.3531 35 21.6923 34.8495 21.9423 34.5816C22.1924 34.3137 22.3328 33.9503 22.3328 33.5714C22.3328 33.1925 22.1924 32.8292 21.9423 32.5613C21.6923 32.2934 21.3531 32.1429 20.9995 32.1429ZM35.6669 15H29.0005C28.6469 15 28.3077 15.1505 28.0577 15.4184C27.8076 15.6863 27.6672 16.0497 27.6672 16.4286C27.6672 16.8075 27.8076 17.1708 28.0577 17.4387C28.3077 17.7066 28.6469 17.8571 29.0005 17.8571H35.6669C37.435 17.8571 39.1306 18.6097 40.3808 19.9492C41.6311 21.2888 42.3334 23.1056 42.3334 25C42.3334 26.8944 41.6311 28.7112 40.3808 30.0508C39.1306 31.3903 37.435 32.1429 35.6669 32.1429H29.0005C28.6469 32.1429 28.3077 32.2934 28.0577 32.5613C27.8076 32.8292 27.6672 33.1925 27.6672 33.5714C27.6672 33.9503 27.8076 34.3137 28.0577 34.5816C28.3077 34.8495 28.6469 35 29.0005 35H35.6669C38.1422 35 40.5161 33.9464 42.2664 32.0711C44.0167 30.1957 45 27.6522 45 25C45 22.3478 44.0167 19.8043 42.2664 17.9289C40.5161 16.0536 38.1422 15 35.6669 15Z"
                />
              </svg>
              <span class="text-sm">网址</span>
            </label>
            <input
              id="url"
              v-model="url"
              class="input-style"
              type="url"
              name="url"
              placeholder="https://example.com"
            >
          </div>
          <div class="space-y-2 relative">
            <div class="flex justify-between items-center">
              <div class="label-style">
                <svg
                  class="w-5 h-5"
                  viewBox="0 0 50 50"
                  fill="currentColor"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M41 14.1818H25.1214L20 8.90545C19.7221 8.61753 19.3915 8.38926 19.0274 8.23384C18.6633 8.07842 18.2729 7.99895 17.8788 8.00001H8C7.20462 8.00093 6.44208 8.32688 5.87967 8.90633C5.31725 9.48579 5.00089 10.2714 5 11.0909V39.0279C5.00084 39.8159 5.30504 40.5713 5.84584 41.1285C6.38664 41.6857 7.11988 41.9991 7.88469 42H41.1667C41.9179 41.9991 42.638 41.6913 43.1692 41.144C43.7004 40.5968 43.9992 39.8548 44 39.0808V17.2727C43.9991 16.4533 43.6827 15.6676 43.1203 15.0881C42.5579 14.5087 41.7954 14.1827 41 14.1818ZM17.8788 11.0909L20.8786 14.1818H8V11.0909H17.8788ZM41 38.9091H8V17.2727H41V38.9091Z"
                  />
                </svg>
                <span class="text-sm">文件夹</span>
              </div>
              <button
                title="add new folder"
                class="p-0.5 text-yellow-400 hover:text-white hover:bg-yellow-400 rounded"
                @click="showCardHandler"
              >
                <svg
                  class="w-4 h-4"
                  viewBox="0 0 50 50"
                  fill="currentColor"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M41 14H25.1212L20 8.87901C19.7222 8.5995 19.3916 8.37788 19.0276 8.227C18.6635 8.07612 18.2731 7.99896 17.879 8.00001H8C7.20459 8.0008 6.44199 8.31713 5.87956 8.87957C5.31712 9.442 5.00079 10.2046 5 11V38.1157C5.00104 38.8806 5.30544 39.6138 5.84641 40.1545C6.38738 40.6952 7.12075 40.9993 7.88562 41H41.1669C41.918 40.999 42.638 40.7002 43.1691 40.1691C43.7002 39.638 43.999 38.918 44 38.1669V17.0002C43.9992 16.2048 43.6829 15.4422 43.1204 14.8798C42.558 14.3173 41.7954 14.001 41 14.0002V14ZM8 11H17.879L20.879 14H8V11Z"
                  />
                </svg>
              </button>
            </div>

            <button
              title="show recently used folders"
              class="w-full px-2 py-1 flex justify-between items-center text-gray-300 hover:text-gray-800 border border-gray-300 rounded"
              @click="showRecentFolders = !showRecentFolders"
            >
              <p class="text-sm text-gray-800">
                {{ selectFolder ? selectFolder.title : '请选择文件夹' }}
              </p>
              <div
                class="transition-transform duration-300"
                :class="{ 'transform rotate-180': showRecentFolders }"
              >
                <svg
                  class="w-4 h-4"
                  viewBox="0 0 50 50"
                  fill="currentColor"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.50594 16.9875L23.7786 34.4874C23.939 34.6499 24.1294 34.7788 24.339 34.8668C24.5485 34.9547 24.7732 35 25 35C25.2268 35 25.4514 34.9547 25.661 34.8668C25.8706 34.7788 26.061 34.6499 26.2214 34.4874L43.4941 16.9875C43.7356 16.7427 43.9002 16.4309 43.9668 16.0914C44.0335 15.7519 43.9993 15.4001 43.8685 15.0803C43.7378 14.7605 43.5164 14.4872 43.2323 14.2949C42.9483 14.1026 42.6143 14 42.2727 14H7.72733C7.3857 14 7.05174 14.1026 6.76768 14.2949C6.48362 14.4872 6.26222 14.7605 6.13148 15.0803C6.00075 15.4001 5.96655 15.7519 6.0332 16.0914C6.09985 16.4309 6.26436 16.7427 6.50594 16.9875Z"
                  />
                </svg>
              </div>
            </button>
            <div
              v-show="showRecentFolders"
              class="wrapper h-0 absolute -bottom-1 inset-x-0 z-10 select-none"
            >
              <div
                class="recent-folders-popup w-full p-2 flex flex-wrap absolute border border-gray-300 bg-white rounded shadow"
              >
                <button
                  v-for="folder of recentFolders"
                  :key="folder.id"
                  class="px-2 py-1 ml-2 mt-2 text-xs text-white bg-yellow-400 hover:bg-yellow-600 rounded"
                  @click="setSelectFolderHandler(folder)"
                >
                  {{ folder.title }}
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="w-full p-2 flex justify-center items-center space-x-4">
          <button
            title="toggle bookmark share property"
            class="p-1 rounded"
            :class="{
              'text-green-400 hover:text-white hover:bg-green-400': !share,
              'text-white bg-green-400 hover:bg-green-600': share
            }"
            @click="share = !share"
          >
            <svg
              class="w-4 h-4"
              viewBox="0 0 50 50"
              fill="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M34.9183 30.7139C33.9734 30.7136 33.0381 30.9046 32.1678 31.2756C31.2974 31.6466 30.5098 32.1901 29.8515 32.8738L21.6901 27.5808C22.331 25.9199 22.331 24.0769 21.6901 22.416L29.8515 17.1232C31.0766 18.3875 32.7235 19.148 34.4728 19.2571C36.2221 19.3662 37.9493 18.8163 39.3196 17.7139C40.6898 16.6114 41.6055 15.0351 41.8892 13.2903C42.1729 11.5455 41.8043 9.75662 40.855 8.27038C39.9056 6.78413 38.4431 5.7064 36.7509 5.24608C35.0586 4.78576 33.2573 4.97564 31.6959 5.77891C30.1346 6.58219 28.9245 7.94165 28.3002 9.59377C27.6759 11.2459 27.6819 13.073 28.317 14.7209L20.1554 20.0139C19.1726 18.9959 17.9111 18.2967 16.5324 18.0057C15.1536 17.7146 13.7201 17.845 12.4151 18.3801C11.1101 18.9153 9.99303 19.8308 9.20656 21.0098C8.42009 22.1887 8 23.5775 8 24.9985C8 26.4196 8.42009 27.8083 9.20656 28.9873C9.99303 30.1662 11.1101 31.0818 12.4151 31.6169C13.7201 32.152 15.1536 32.2824 16.5324 31.9914C17.9111 31.7003 19.1726 31.0011 20.1554 29.9831L28.317 35.2759C27.7706 36.6983 27.6899 38.2598 28.0868 39.7318C28.4837 41.2037 29.3373 42.5089 30.5226 43.4561C31.7079 44.4033 33.1627 44.9428 34.6739 44.9957C36.1852 45.0486 37.6735 44.612 38.921 43.7499C40.1685 42.8877 41.1096 41.6454 41.6066 40.2047C42.1036 38.764 42.1304 37.2006 41.6829 35.7434C41.2355 34.2863 40.3374 33.0119 39.1202 32.1069C37.9029 31.2018 36.4304 30.7137 34.9183 30.7139ZM34.9183 7.85223C35.7587 7.85223 36.5802 8.10363 37.279 8.57465C37.9777 9.04566 38.5224 9.71513 38.844 10.4984C39.1656 11.2817 39.2497 12.1436 39.0858 12.9751C38.9218 13.8066 38.5171 14.5704 37.9229 15.1699C37.3286 15.7693 36.5715 16.1776 35.7472 16.343C34.923 16.5084 34.0686 16.4235 33.2922 16.0991C32.5157 15.7746 31.8521 15.2252 31.3852 14.5203C30.9183 13.8154 30.6691 12.9866 30.6691 12.1388C30.6703 11.0023 31.1184 9.91276 31.915 9.10915C32.7116 8.30554 33.7917 7.85351 34.9183 7.85223ZM15.0888 29.2851C14.2484 29.2851 13.4268 29.0337 12.7281 28.5627C12.0293 28.0916 11.4847 27.4222 11.1631 26.6389C10.8415 25.8556 10.7573 24.9938 10.9213 24.1622C11.0852 23.3307 11.4899 22.5669 12.0842 21.9674C12.6784 21.368 13.4356 20.9597 14.2598 20.7943C15.0841 20.6289 15.9384 20.7138 16.7149 21.0382C17.4913 21.3627 18.1549 21.9121 18.6218 22.617C19.0887 23.3219 19.338 24.1507 19.338 24.9985C19.3367 26.135 18.8886 27.2246 18.092 28.0282C17.2954 28.8318 16.2153 29.2838 15.0888 29.2851ZM34.9183 42.1448C34.0778 42.1448 33.2563 41.8934 32.5575 41.4224C31.8588 40.9514 31.3141 40.2819 30.9925 39.4986C30.6709 38.7153 30.5868 37.8535 30.7507 37.0219C30.9147 36.1904 31.3194 35.4266 31.9136 34.8272C32.5079 34.2277 33.265 33.8194 34.0893 33.654C34.9135 33.4886 35.7679 33.5735 36.5443 33.8979C37.3208 34.2224 37.9844 34.7718 38.4513 35.4767C38.9182 36.1817 39.1674 37.0104 39.1674 37.8582C39.1662 38.9947 38.7181 40.0843 37.9215 40.8879C37.1249 41.6915 36.0448 42.1435 34.9183 42.1448Z"
              />
            </svg>
          </button>
          <button
            title="toggle bookmark star property"
            class="p-1 rounded"
            :class="{
              'text-yellow-400 hover:text-white hover:bg-yellow-400': !star,
              'text-white bg-yellow-400 hover:bg-yellow-600': star
            }"
            @click="star = !star"
          >
            <svg
              class="w-4 h-4"
              viewBox="0 0 50 50"
              fill="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M35.5819 44C35.0316 43.9995 34.4928 43.8445 34.0286 43.5533L25.0232 37.9313C25.0165 37.9264 25.0084 37.9237 25 37.9237C24.9916 37.9237 24.9835 37.9264 24.9768 37.9313L16.6078 43.156C16.0683 43.4954 15.4374 43.6664 14.7976 43.6466C14.1579 43.6267 13.5391 43.4171 13.0223 43.045C12.4873 42.6632 12.0817 42.1311 11.8587 41.5185C11.6357 40.9058 11.6056 40.241 11.7724 39.6112L14.1856 30.2582C14.1921 30.2349 14.1922 30.2103 14.1858 30.187C14.1795 30.1636 14.1669 30.1423 14.1494 30.1254L6.07358 23.5023C5.61332 23.1256 5.2791 22.6208 5.1146 22.0539C4.95009 21.487 4.96296 20.8844 5.15151 20.3248C5.32919 19.7728 5.67173 19.2865 6.13437 18.9293C6.59701 18.5721 7.15823 18.3608 7.7447 18.3228L18.2912 17.6484C18.3052 17.6451 18.318 17.6381 18.3284 17.6282C18.3387 17.6184 18.3462 17.606 18.3501 17.5923L22.2838 7.83224C22.4963 7.29262 22.8694 6.82891 23.3542 6.50194C23.8389 6.17496 24.4126 6 25.0001 6C25.5875 6 26.1613 6.17496 26.646 6.50194C27.1307 6.82891 27.5039 7.29262 27.7164 7.83224L31.65 17.5921C31.6539 17.6058 31.6613 17.6182 31.6716 17.6281C31.6819 17.638 31.6947 17.645 31.7086 17.6484L42.2553 18.3228C42.8417 18.3608 43.4029 18.5721 43.8655 18.9292C44.3282 19.2863 44.6707 19.7726 44.8485 20.3245C45.037 20.8841 45.0499 21.4866 44.8854 22.0535C44.7209 22.6204 44.3867 23.1252 43.9264 23.502L35.851 30.1249C35.8334 30.1418 35.8207 30.1631 35.8144 30.1866C35.808 30.21 35.8081 30.2347 35.8147 30.258L38.4167 40.3433C38.5676 40.9136 38.5402 41.5155 38.3381 42.0702C38.1361 42.625 37.7688 43.1067 37.2842 43.4523C36.7898 43.8074 36.1939 43.9991 35.5821 43.9998L35.5819 44ZM25 35.1121C25.5493 35.1113 26.0876 35.2644 26.552 35.5535L35.5578 41.1755C35.5657 41.1809 35.5745 41.1852 35.5837 41.1883C35.6056 41.1775 35.6244 41.1614 35.6383 41.1415C35.6483 41.1261 35.6544 41.1086 35.656 41.0904C35.6576 41.0722 35.6548 41.0539 35.6478 41.037L33.0458 30.9516C32.9072 30.413 32.9254 29.8469 33.0983 29.3181C33.2711 28.7892 33.5916 28.319 34.0231 27.9613L42.0987 21.3384C42.1204 21.3223 42.1356 21.2992 42.1417 21.2731C42.1478 21.2471 42.1443 21.2197 42.1319 21.1959C42.1117 21.1349 42.0907 21.1335 42.0701 21.1322L31.5236 20.4579C30.9703 20.4189 30.4393 20.2268 29.9919 19.9036C29.5444 19.5804 29.1987 19.1393 28.9945 18.6311L25.0609 8.87134C25.0384 8.81504 25.0239 8.81504 25 8.81504C24.9761 8.81504 24.9616 8.81504 24.9389 8.87134L21.0053 18.6312C20.801 19.1394 20.4553 19.5805 20.0079 19.9036C19.5605 20.2268 19.0295 20.4189 18.4762 20.4579L7.92987 21.1322C7.90933 21.1335 7.88826 21.1349 7.86809 21.1959C7.85568 21.2197 7.85222 21.2471 7.85829 21.2731C7.86437 21.2992 7.8796 21.3223 7.9013 21.3384L15.9771 27.9615C16.4085 28.3192 16.729 28.7894 16.9018 29.3182C17.0746 29.847 17.0928 30.4131 16.9544 30.9516L14.5413 40.3046C14.5143 40.3881 14.515 40.4779 14.5435 40.5609C14.572 40.6439 14.6266 40.7158 14.6995 40.7661C14.7522 40.8097 14.8182 40.8346 14.887 40.8368C14.9557 40.839 15.0232 40.8183 15.0786 40.778L23.448 35.5535C23.9124 35.2644 24.4506 35.1112 25 35.1119V35.1121Z"
              />
            </svg>
          </button>
        </div>
        <div class="framework">
          <ItemsInput
            :items="tags"
            :candidates="allTags"
            :placeholder="请输入标签"
            :modal-title="是否删除该标签"
            @add-item="tags.push($event)"
            @delete-item="deleteTagsItemHandler"
          >
            <template #labelIcon>
              <svg
                class="w-5 h-5"
                viewBox="0 0 50 50"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M43.1947 23.754L25.2464 5.80594C24.9268 5.48534 24.5327 5.24888 24.0993 5.11767C23.666 4.98646 23.2069 4.96459 22.7631 5.05401L8.90377 7.82581C8.63772 7.87911 8.39338 8.00993 8.20151 8.2018C8.00964 8.39366 7.87882 8.638 7.82552 8.90405L5.05386 22.7632C4.96461 23.2071 4.98654 23.6661 5.11771 24.0993C5.24888 24.5326 5.48521 24.9267 5.80563 25.2465L23.7537 43.1944C24.009 43.4498 24.3121 43.6524 24.6457 43.7906C24.9793 43.9288 25.3369 44 25.698 44C26.0591 44 26.4166 43.9289 26.7502 43.7907C27.0839 43.6525 27.387 43.45 27.6423 43.1946L43.1945 27.6424C43.4499 27.3871 43.6524 27.084 43.7906 26.7504C43.9288 26.4168 44 26.0593 44 25.6982C44 25.3372 43.9289 24.9796 43.7907 24.646C43.6526 24.3124 43.45 24.0093 43.1947 23.754ZM25.6982 41.2505L7.74974 23.3024L10.3418 10.3423L23.3023 7.75021L41.2506 25.6983L25.6982 41.2505ZM18.4508 16.389C18.4508 16.7968 18.3299 17.1955 18.1033 17.5346C17.8767 17.8737 17.5547 18.1379 17.1779 18.294C16.8011 18.4501 16.3865 18.4909 15.9865 18.4114C15.5865 18.3318 15.2191 18.1354 14.9308 17.847C14.6424 17.5587 14.446 17.1913 14.3664 16.7913C14.2869 16.3913 14.3277 15.9767 14.4838 15.5999C14.6398 15.2231 14.9041 14.9011 15.2432 14.6745C15.5823 14.448 15.981 14.327 16.3888 14.327C16.9355 14.3276 17.4596 14.5451 17.8462 14.9316C18.2328 15.3182 18.4502 15.8423 18.4508 16.389Z"
                />
              </svg>
            </template>
            <template #labeName>
              <span class="text-sm">标签</span>
            </template>
            <template #itemIcon>
              <svg
                class="w-4 h-4"
                viewBox="0 0 50 50"
                fill="currentColor
                  "
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M43.1947 23.754L25.2464 5.80594C24.9268 5.48534 24.5327 5.24888 24.0993 5.11767C23.666 4.98646 23.2069 4.96459 22.7631 5.05401L8.90377 7.82581C8.63772 7.87911 8.39338 8.00993 8.20151 8.2018C8.00964 8.39366 7.87882 8.638 7.82552 8.90405L5.05386 22.7632C4.96461 23.2071 4.98654 23.6661 5.11771 24.0993C5.24888 24.5326 5.48521 24.9267 5.80563 25.2465L23.7537 43.1944C24.009 43.4498 24.3121 43.6524 24.6457 43.7906C24.9793 43.9288 25.3369 44 25.698 44C26.0591 44 26.4166 43.9289 26.7502 43.7907C27.0839 43.6525 27.387 43.45 27.6423 43.1946L43.1945 27.6424C43.4499 27.3871 43.6524 27.084 43.7906 26.7504C43.9288 26.4168 44 26.0593 44 25.6982C44 25.3372 43.9289 24.9796 43.7907 24.646C43.6526 24.3124 43.45 24.0093 43.1947 23.754ZM25.6982 41.2505L7.74974 23.3024L10.3418 10.3423L23.3023 7.75021L41.2506 25.6983L25.6982 41.2505ZM18.4508 16.389C18.4508 16.7968 18.3299 17.1955 18.1033 17.5346C17.8767 17.8737 17.5547 18.1379 17.1779 18.294C16.8011 18.4501 16.3865 18.4909 15.9865 18.4114C15.5865 18.3318 15.2191 18.1354 14.9308 17.847C14.6424 17.5587 14.446 17.1913 14.3664 16.7913C14.2869 16.3913 14.3277 15.9767 14.4838 15.5999C14.6398 15.2231 14.9041 14.9011 15.2432 14.6745C15.5823 14.448 15.981 14.327 16.3888 14.327C16.9355 14.3276 17.4596 14.5451 17.8462 14.9316C18.2328 15.3182 18.4502 15.8423 18.4508 16.389Z"
                />
              </svg>
            </template>
          </ItemsInput>
          <ItemsInput
            :items="groups"
            :candidates="allGroups"
            :placeholder="请输入分组"
            :modal-title="是否删除该分组"
            @add-item="groups.push($event)"
            @delete-item="deleteGroupsItemHandler"
          >
            <template #labelIcon>
              <svg
                class="w-5 h-5"
                viewBox="0 0 50 50"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M42.6412 15.0387C42.6367 15.0302 42.6333 15.0215 42.6284 15.0131C42.6265 15.0096 42.6239 15.0062 42.6218 15.0027C42.374 14.5747 42.0172 14.221 41.5882 13.9781L26.3576 5.35549C25.9426 5.12238 25.4753 5 25 5C24.5247 5 24.0574 5.12238 23.6424 5.35549L8.41144 13.9781C7.98088 14.2222 7.6231 14.5778 7.37523 15.0081C7.37263 15.0128 7.36935 15.017 7.36658 15.0218C7.3626 15.0293 7.35948 15.0372 7.35533 15.0448C7.12275 15.4609 7.00039 15.9302 7 16.4075V33.5903C7.00036 34.0848 7.13125 34.5703 7.37928 34.9972C7.62731 35.424 7.98358 35.7769 8.41162 36.0196L23.6426 44.6422C24.0262 44.8581 24.4555 44.9788 24.8948 44.9944C24.9263 44.9969 24.9576 44.9997 24.9896 45H25.0021C25.0457 45 25.0888 44.9976 25.1314 44.9936C25.5617 44.9743 25.9817 44.854 26.3576 44.6422L41.5884 36.0196C42.0165 35.7769 42.3728 35.424 42.6209 34.9971C42.8689 34.5701 42.9998 34.0845 43 33.59V16.4075C42.9996 15.9278 42.876 15.4564 42.6412 15.0389V15.0387ZM25 7.78479L38.8017 15.5984L33.5021 18.6287L19.5377 10.8771L25 7.78479ZM25.1575 23.3998L11.2194 15.5864L16.6991 12.4842L30.6774 20.2436L25.1575 23.3998ZM26.4057 41.417L26.5418 25.8138L32.1 22.6358V29.2684C32.1 29.638 32.2458 29.9925 32.5055 30.2538C32.7652 30.5151 33.1174 30.662 33.4846 30.662C33.8518 30.662 34.204 30.5151 34.4636 30.2538C34.7233 29.9925 34.8692 29.638 34.8692 29.2684V21.0524L40.2308 17.9868V33.5902L26.4057 41.417Z"
                />
              </svg>
            </template>
            <template #labeName>
              <span class="text-sm">分组</span>
            </template>
            <template #itemIcon>
              <svg
                class="w-4 h-4"
                viewBox="0 0 50 50"
                fill="currentColor
                  "
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M42.6412 15.0387C42.6367 15.0302 42.6333 15.0215 42.6284 15.0131L42.6218 15.0027C42.374 14.5747 42.0172 14.221 41.5882 13.9781L26.3576 5.35549C25.9426 5.12238 25.4753 5 25 5C24.5247 5 24.0574 5.12238 23.6424 5.35549L8.41144 13.9781C7.98088 14.2222 7.6231 14.5778 7.37523 15.0081C7.37263 15.0128 7.36935 15.017 7.36658 15.0218C7.3626 15.0293 7.35948 15.0372 7.35533 15.0448C7.12275 15.4609 7.00039 15.9302 7 16.4075V33.5903C7.00036 34.0848 7.13125 34.5703 7.37928 34.9972C7.62731 35.424 7.98358 35.7769 8.41162 36.0196L23.6426 44.6422C24.0262 44.8581 24.4555 44.9788 24.8948 44.9944C24.9263 44.9969 24.9576 44.9997 24.9896 45H25.0021C25.0457 45 25.0886 44.9976 25.1314 44.9936C25.5617 44.9743 25.9817 44.854 26.3576 44.6422L41.5884 36.0196C42.0165 35.7769 42.3728 35.424 42.6209 34.9971C42.8689 34.5701 42.9998 34.0845 43 33.59V16.4075C42.9996 15.9278 42.876 15.4564 42.6412 15.0389V15.0387ZM25 7.78479L38.8017 15.5984L33.5021 18.6287L19.5377 10.8771L25 7.78479ZM25.1575 23.3998L11.2194 15.5864L16.6991 12.4842L30.6774 20.2436L25.1575 23.3998ZM9.76923 17.9636L23.7724 25.8136L23.636 41.4405L9.76923 33.5903V17.9636ZM26.4057 41.417L26.5419 25.8138L32.1 22.6358V29.2684C32.1 29.638 32.2458 29.9925 32.5055 30.2538C32.7652 30.5151 33.1174 30.662 33.4846 30.662C33.8518 30.662 34.204 30.5151 34.4636 30.2538C34.7233 29.9925 34.8692 29.638 34.8692 29.2684V21.0524L40.2308 17.9868V33.5902L26.4057 41.417Z"
                />
              </svg>
            </template>
          </ItemsInput>
          <div class="space-y-2">
            <label
              for="sticker"
              class="label-style"
            >
              <svg
                class="w-5 h-5"
                viewBox="0 0 50 50"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M44.9806 26.9083C44.9929 26.8284 44.9994 26.7476 45 26.6667V16.6667C44.9965 13.5735 43.7662 10.6081 41.5791 8.42092C39.3919 6.23375 36.4265 5.00347 33.3333 5H16.6667C13.5735 5.00347 10.6081 6.23375 8.42092 8.42092C6.23375 10.6081 5.00347 13.5735 5 16.6667V33.3333C5.00347 36.4265 6.23375 39.3919 8.42092 41.5791C10.6081 43.7662 13.5735 44.9965 16.6667 45H26.6667C26.7476 44.9994 26.8284 44.9929 26.9083 44.9806C26.9233 44.9783 26.9383 44.9765 26.9533 44.9737C27.0319 44.9603 27.1094 44.9412 27.1852 44.9167L27.1937 44.9146C32.659 43.0927 43.0927 32.659 44.9146 27.1937L44.9167 27.1854C44.9412 27.1095 44.9602 27.032 44.9735 26.9533C44.9762 26.9383 44.9783 26.9233 44.9806 26.9081V26.9083ZM8.33333 33.3333V16.6667C8.33587 14.4573 9.21466 12.3392 10.7769 10.7769C12.3392 9.21466 14.4573 8.33587 16.6667 8.33333H33.3333C35.5427 8.33587 37.6608 9.21466 39.2231 10.7769C40.7853 12.3392 41.6641 14.4573 41.6667 16.6667V25H36.6667C33.5735 25.0035 30.6081 26.2338 28.4209 28.4209C26.2338 30.6081 25.0035 33.5735 25 36.6667V41.6667H16.6667C14.4573 41.6641 12.3392 40.7853 10.7769 39.2231C9.21466 37.6608 8.33587 35.5427 8.33333 33.3333ZM28.3333 40.6537V36.6667C28.3359 34.4573 29.2147 32.3392 30.7769 30.7769C32.3392 29.2147 34.4573 28.3359 36.6667 28.3333H40.6537C38.1194 32.3967 32.3969 38.1196 28.3333 40.6537Z"
                />
              </svg>
              <span class="text-sm">简介</span>
            </label>
            <textarea
              id="sticker"
              v-model="description"
              class="input-style"
              rows="5"
              name="sticker"
              placeholder="请输入书签简介"
            />
          </div>
        </div>
      </div>
    </div>

    <footer class="w-full bg-white">
      <div class="w-full p-2">
        <button
          title="finish editing bookmark"
          class="w-full py-1 text-sm text-white bg-green-400 rounded"
          @click="finishBookmark"
        >
          完成
        </button>
      </div>
      <div class="w-full px-4 py-2 flex justify-between items-center border-t border-gray-200">
        <button
          title="expand window button"
          class="btn"
        >
          <svg
            class="w-6 h-6"
            viewBox="0 0 50 50"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M42 9.54642V18.8182C42 19.2281 41.8372 19.6212 41.5473 19.911C41.2575 20.2008 40.8644 20.3636 40.4545 20.3636C40.0447 20.3636 39.6516 20.2008 39.3617 19.911C39.0719 19.6212 38.9091 19.2281 38.9091 18.8182V13.2766L30.7292 21.4565C30.5857 21.6 30.4153 21.7138 30.2278 21.7915C30.0403 21.8692 29.8393 21.9091 29.6364 21.9091C29.4334 21.9091 29.2324 21.8692 29.0449 21.7915C28.8574 21.7138 28.687 21.6 28.5435 21.4565C28.4 21.313 28.2862 21.1426 28.2085 20.9551C28.1308 20.7676 28.0909 20.5666 28.0909 20.3636C28.0909 20.1607 28.1308 19.9597 28.2085 19.7722C28.2862 19.5847 28.4 19.4143 28.5435 19.2708L36.7234 11.0909H31.1818C30.7719 11.0909 30.3788 10.9281 30.089 10.6383C29.7992 10.3484 29.6364 9.95533 29.6364 9.54545C29.6364 9.13557 29.7992 8.74248 30.089 8.45265C30.3788 8.16282 30.7719 8 31.1818 8H40.4545C40.4603 8 40.4659 8.00077 40.4715 8.00077C40.5168 8.00135 40.5618 8.00328 40.6066 8.00773C40.6315 8.01005 40.6556 8.01468 40.68 8.01835C40.7055 8.02202 40.731 8.02492 40.7561 8.02994C40.7831 8.03535 40.8096 8.04269 40.8363 8.04926C40.8583 8.05506 40.8807 8.05989 40.9027 8.06665C40.9286 8.07438 40.9537 8.08403 40.979 8.09311C41.0012 8.10123 41.0235 8.10857 41.0457 8.11765C41.0689 8.12731 41.0913 8.1387 41.1141 8.14933C41.1372 8.16034 41.1604 8.17058 41.1828 8.18256C41.2043 8.19415 41.2248 8.20709 41.2456 8.21965C41.268 8.23317 41.2908 8.24573 41.3127 8.26022C41.3353 8.27548 41.3565 8.29228 41.3783 8.30851C41.3969 8.32242 41.4162 8.33556 41.4344 8.35043C41.4703 8.37999 41.5047 8.41128 41.5377 8.44393C41.5408 8.44702 41.5443 8.44973 41.5474 8.45262C41.5512 8.45649 41.5547 8.46093 41.5586 8.46499C41.5901 8.49725 41.6208 8.53067 41.6494 8.56544C41.6654 8.58495 41.6793 8.60543 41.6942 8.62533C41.7095 8.64581 41.7251 8.6659 41.7394 8.68695C41.755 8.71014 41.7686 8.73448 41.7829 8.75843C41.7945 8.77775 41.8064 8.79649 41.8171 8.81639C41.8302 8.84073 41.8412 8.86565 41.8528 8.89057C41.8626 8.91163 41.8733 8.9321 41.8822 8.95355C41.8918 8.97769 41.9001 9.00223 41.9088 9.02657C41.9171 9.04975 41.9262 9.07255 41.9332 9.09611C41.9407 9.12084 41.9463 9.14595 41.9525 9.17107C41.9583 9.19502 41.965 9.21859 41.9699 9.24293C41.9757 9.2721 41.9793 9.30147 41.9834 9.33083C41.9863 9.3515 41.9901 9.37159 41.9923 9.39245C41.9974 9.44371 42 9.49503 42 9.54642ZM19.2708 28.5435L11.0909 36.7234V31.1818C11.0909 30.7719 10.9281 30.3788 10.6383 30.089C10.3484 29.7992 9.95533 29.6364 9.54545 29.6364C9.13557 29.6364 8.74248 29.7992 8.45265 30.089C8.16282 30.3788 8 30.7719 8 31.1818V40.4536C8 40.505 8.00258 40.5563 8.00773 40.6075C8.00966 40.6284 8.01372 40.6485 8.01661 40.6692C8.02067 40.6985 8.02434 40.7279 8.03014 40.7571C8.03497 40.7814 8.04173 40.805 8.04752 40.8289C8.0537 40.854 8.05931 40.8792 8.06684 40.9037C8.07399 40.9275 8.08288 40.9501 8.09118 40.9732C8.09988 40.9978 8.10799 41.0223 8.11784 41.0466C8.12673 41.0679 8.13716 41.0884 8.1472 41.1094C8.1588 41.1343 8.16981 41.1593 8.18294 41.1836C8.19357 41.2035 8.20555 41.2223 8.21714 41.2416C8.23143 41.2655 8.24495 41.2899 8.2606 41.313C8.2747 41.3343 8.29055 41.3542 8.30581 41.3745C8.32068 41.3946 8.33459 41.415 8.35062 41.4344C8.37922 41.4693 8.40993 41.5027 8.44142 41.5348C8.44528 41.5389 8.44857 41.5433 8.45262 41.5474C8.45572 41.5505 8.45919 41.553 8.46228 41.5561C8.49532 41.5887 8.5299 41.62 8.56583 41.6496C8.58399 41.6646 8.60331 41.6776 8.62185 41.6917C8.64349 41.7079 8.66474 41.7245 8.68734 41.7396C8.70936 41.7545 8.73235 41.7674 8.75515 41.7809C8.77582 41.7931 8.79572 41.806 8.81697 41.8174C8.84015 41.8298 8.86391 41.8402 8.88767 41.8514C8.90969 41.8619 8.93133 41.8727 8.95393 41.8824C8.97692 41.8916 9.0003 41.8994 9.02348 41.9077C9.04782 41.9164 9.07177 41.9258 9.09689 41.9333C9.12007 41.9403 9.14344 41.9455 9.16682 41.9513C9.19232 41.9577 9.21743 41.9648 9.24332 41.9701C9.27056 41.9755 9.29818 41.9786 9.32542 41.9826C9.34802 41.9857 9.37005 41.99 9.39303 41.9923C9.44365 41.9973 9.49445 42 9.54545 42H18.8182C19.2281 42 19.6212 41.8372 19.911 41.5473C20.2008 41.2575 20.3636 40.8644 20.3636 40.4545C20.3636 40.0447 20.2008 39.6516 19.911 39.3617C19.6212 39.0719 19.2281 38.9091 18.8182 38.9091H13.2766L21.4565 30.7292C21.6 30.5857 21.7138 30.4153 21.7915 30.2278C21.8692 30.0403 21.9091 29.8393 21.9091 29.6364C21.9091 29.4334 21.8692 29.2324 21.7915 29.0449C21.7138 28.8574 21.6 28.687 21.4565 28.5435C21.313 28.4 21.1426 28.2862 20.9551 28.2085C20.7676 28.1308 20.5666 28.0909 20.3636 28.0909C20.1607 28.0909 19.9597 28.1308 19.7722 28.2085C19.5847 28.2862 19.4143 28.4 19.2708 28.5435Z"
            />
          </svg>
        </button>
        <button
          title="browser all bookmarks"
          class="btn flex flex-col justify-center items-center space-y-0.5"
          @click="changePage('browser')"
        >
          <div class="p-0.5">
            <svg
              class="w-2 h-2"
              viewBox="0 0 50 50"
              fill="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M43.2272 36C42.9944 36.0003 42.7638 35.9551 42.5486 35.8672C42.3335 35.7792 42.1381 35.6502 41.9737 35.4874L25.5 19.225L9.0263 35.4874C8.69385 35.8156 8.24294 36 7.77277 36C7.3026 36 6.85169 35.8156 6.51923 35.4874C6.18677 35.1592 6 34.7141 6 34.25C6 33.7858 6.18677 33.3407 6.51923 33.0125L24.2465 15.5126C24.4111 15.3501 24.6065 15.2212 24.8216 15.1332C25.0367 15.0453 25.2672 15 25.5 15C25.7328 15 25.9633 15.0453 26.1784 15.1332C26.3935 15.2212 26.5889 15.3501 26.7535 15.5126L44.4807 33.0125C44.7287 33.2572 44.8975 33.5691 44.9659 33.9085C45.0343 34.248 44.9992 34.5999 44.8651 34.9197C44.7309 35.2394 44.5037 35.5128 44.2121 35.7051C43.9206 35.8973 43.5778 36 43.2272 36Z"
              />
            </svg>
          </div>
          <span class="text-xs">浏览书签</span>
        </button>
        <button
          title="archive tabs button"
          class="btn"
        >
          <svg
            class="w-6 h-6"
            viewBox="0 0 50 50"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M42.1429 10H7.85714C7.09964 10.0009 6.37341 10.3067 5.83778 10.8503C5.30214 11.394 5.00085 12.1311 5 12.9V17.25C5.00085 18.0189 5.30214 18.756 5.83778 19.2997C6.37341 19.8433 7.09964 20.1491 7.85714 20.15V36.1C7.85799 36.8689 8.15929 37.606 8.69492 38.1497C9.23055 38.6933 9.95679 38.9991 10.7143 39H39.2857C40.0432 38.9991 40.7694 38.6933 41.3051 38.1497C41.8407 37.606 42.142 36.8689 42.1429 36.1V20.15C42.9004 20.1491 43.6266 19.8433 44.1622 19.2997C44.6979 18.756 44.9991 18.0189 45 17.25V12.9C44.9991 12.1311 44.6979 11.394 44.1622 10.8503C43.6266 10.3067 42.9004 10.0009 42.1429 10ZM39.2857 36.1H10.7143V20.15H39.2857V36.1ZM42.1429 17.25H7.85714V12.9H42.1429L42.1446 17.25H42.1429ZM19.2857 25.95C19.2857 25.5654 19.4362 25.1966 19.7041 24.9247C19.972 24.6528 20.3354 24.5 20.7143 24.5H29.2857C29.6646 24.5 30.028 24.6528 30.2959 24.9247C30.5638 25.1966 30.7143 25.5654 30.7143 25.95C30.7143 26.3346 30.5638 26.7034 30.2959 26.9753C30.028 27.2472 29.6646 27.4 29.2857 27.4H20.7143C20.3354 27.4 19.972 27.2472 19.7041 26.9753C19.4362 26.7034 19.2857 26.3346 19.2857 25.95Z"
            />
          </svg>
        </button>
      </div>
    </footer>

    <div
      v-if="showCard"
      class="fixed inset-0 z-10"
    >
      <div
        class="modal-background absolute inset-0 bg-black opacity-25"
        @click="showSelectFolder = false"
      />
      <transition
        name="popup-card"
        @after-leave="showCard = false"
      >
        <SelectFolders
          v-show="showSelectFolder"
          class="select-folders-modal w-full absolute bottom-0 z-30 bg-white shadow"
          :select-folder="selectFolder"
          @cancel-folder="showSelectFolder = false"
          @save-folder="setSelectFolderHandler"
        />
      </transition>
    </div>

    <PromptModal
      v-if="showDeleteConfirmModal"
      v-model:show="showDeleteConfirmModal"
      @result="getDeleteResult"
    >
      <template #title>
        <h2 class="p-4 text-sm font-bold">
          删除当前书签
        </h2>
      </template>
      <template #msg>
        <p class="p-2 text-xs text-center">
          该操作不可恢复
        </p>
      </template>
    </PromptModal>

    <PopupMsg
      v-if="showFinishMsgPopup"
      v-model:show="showFinishMsgPopup"
    >
      <template #msg>
        <p
          class="p-4 text-sm font-bold"
          :class="{
            'text-green-400': finishMsg === '成功',
            'text-red-400': finishMsg === '失败'
          }"
        >
          {{ finishMsg }}
        </p>
      </template>
    </PopupMsg>
  </div>
</template>
<script>
import {
  ref, inject, toRaw, nextTick,
} from 'vue';
import ItemsInput from './Edit/ItemsInput.vue';
import SelectFolders from './Edit/SelectFolders.vue';
import PromptModal from './Modal/PromptModal.vue';
import PopupMsg from './Modal/PopupMsg.vue';
import useTab from '@/composables/useTab';
import useBookmark from '@/composables/useBookmark';

export default {
  components: {
    ItemsInput,
    SelectFolders,
    PromptModal,
    PopupMsg,
  },
  setup(props, context) {
    const { getActiveTab } = useTab();
    const {
      getBookmarkDB, getBookmarkShare, setBookmarkShare, getBookmarkStar, setBookmarkStar, createBookmark, updateBookmark, deleteBookmark,
    } = useBookmark();

    const finishMsg = ref('');
    const showFinishMsgPopup = ref(false);

    // bookmark state
    // const bookmarkState = inject('bookmarkState');
    // const setBookmarkState = inject('setBookmarkState');

    // delete bookmark
    const showDeleteConfirmModal = ref(false);
    let currentBookmarkId = '';
    const deleteBookmarkHandler = async () => {
      console.log('delete-bookmark');
      const result = await chrome.storage.local.get('currentBookmarkId');
      currentBookmarkId = result.currentBookmarkId;
      if (currentBookmarkId) {
        // console.log(currentBookmarkId);
        showDeleteConfirmModal.value = true;
      }
    };

    const getDeleteResult = (value) => {
      if (value && currentBookmarkId) {
        deleteBookmark(currentBookmarkId).then(() => {
          showFinishMsgPopup.value = true;
          finishMsg.value = '成功';
          setTimeout(() => {
            window.close();
          }, 1000);
        }).catch((err) => {
          showFinishMsgPopup.value = true;
          finishMsg.value = '失败';
          let timer = setTimeout(() => {
            showFinishMsgPopup.value = false;
            timer = null;
            console.log(err);
          }, 500);
        });
      }
    };

    // favicon
    // wait for a new api for favicon
    // refer to: https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/#other-features
    let faviconUrl = '';
    const favicon = ref('/icons/icon64_untag.png');

    // title
    const title = ref('');
    // url
    const url = ref('');
    // folders
    const selectFolder = ref(null);

    // recnet folders
    const recentFolders = ref([]);
    const showRecentFolders = ref(false);
    chrome.bookmarks.getRecent(20).then(async (nodes) => {
      const parentNodesId = [...new Set(nodes.map((node) => node.parentId))];
      recentFolders.value = await chrome.bookmarks.get(parentNodesId);
    });

    // select folder
    const showCard = ref(false);
    const showSelectFolder = ref(false);
    const showCardHandler = async () => {
      showCard.value = true;
      await nextTick();
      showSelectFolder.value = true;
    };
    const setSelectFolderHandler = (folder) => {
      selectFolder.value = folder;
      showRecentFolders.value = false;
      showSelectFolder.value = false;
    };

    // share property
    const share = ref(false);

    // star property
    const star = ref(false);

    // tags
    const tags = ref([]);
    const allTags = ref([]);
    const deleteTagsItemHandler = (value) => {
      const index = tags.value.indexOf(value);
      if (index === -1) return;
      tags.value.splice(index, 1);
    };

    // group
    const groups = ref([]);
    const allGroups = ref([]);
    const deleteGroupsItemHandler = (value) => {
      const index = groups.value.indexOf(value);
      if (index === -1) return;
      groups.value.splice(index, 1);
    };

    // description
    const description = ref('');

    // const bookmarkState = inject('bookmarkState');
    const urlBookmarkState = ref(false);
    const bookmarkNode = {};
    let parentIdInit = '';

    // indexedDB
    const db = inject('db');

    // base on current tab bookmark state to get init data
    getActiveTab().then(async (tab) => {
      // current tab url and favicon
      const tabUrl = tab.url || tab.pendingUrl;
      const tabFaviconUrl = tab.favIconUrl;

      // favicon
      if (tabFaviconUrl) {
        faviconUrl = tabFaviconUrl;
        favicon.value = tabFaviconUrl;
      }

      // get bookmark node
      const nodes = await chrome.bookmarks.search({
        url: tabUrl,
      });

      if (nodes.length === 0) {
        // no bookmark
        urlBookmarkState.value = false;

        title.value = tab.title;
        url.value = tabUrl;

        // set recent used folder as init folder
        chrome.bookmarks.getRecent(1).then(async (recentNodes) => {
          if (recentNodes.length === 0) return;
          const [recentNode] = recentNodes;
          const [folderNode] = await chrome.bookmarks.get(recentNode.parentId);
          selectFolder.value = folderNode;
        });
      } else {
        // already bookmark
        urlBookmarkState.value = true;

        if (!tabFaviconUrl) favicon.value = '/icons/icon64_tag.png';

        const [node] = nodes;
        bookmarkNode.id = node.id;
        bookmarkNode.index = node.index;

        title.value = node.title;
        url.value = node.url;
        parentIdInit = node.parentId;
        chrome.bookmarks.get(node.parentId).then(async (parentNodes) => {
          [selectFolder.value] = parentNodes;
        });

        const bookmarkDB = await getBookmarkDB(node.id);
        if (bookmarkDB) {
          tags.value = bookmarkDB.tags;
          groups.value = bookmarkDB.groups;
          description.value = bookmarkDB.description;
        }

        // share state
        const shareInit = await getBookmarkShare(node.id);
        if (shareInit) share.value = shareInit;

        // star state
        const starInit = await getBookmarkStar(node.id);
        if (starInit) star.value = starInit;
      }

      // all tags
      allTags.value = await db.bookmark.orderBy('tags').uniqueKeys();
      // all groups
      allGroups.value = await db.bookmark.orderBy('groups').uniqueKeys();
    });

    // create or update bookmark
    const finishBookmark = async () => {
      const nodeData = {
        title: title.value,
        url: url.value,
        parentId: selectFolder.value.id,
        faviconUrl,
        share: share.value,
        star: star.value,
        // get array value not the Proxy object
        tags: toRaw(tags.value),
        groups: toRaw(groups.value),
        description: description.value,
      };

      if (urlBookmarkState.value) {
        updateBookmark(bookmarkNode.id, {
          ...nodeData,
          index: bookmarkNode.index,
          changeFolder: selectFolder.value.id === parentIdInit,
        }).then(() => {
          showFinishMsgPopup.value = true;
          finishMsg.value = '成功';
          setTimeout(() => {
            window.close();
          }, 1000);
        }).catch((err) => {
          showFinishMsgPopup.value = true;
          finishMsg.value = '失败';
          let timer = setTimeout(() => {
            showFinishMsgPopup.value = false;
            timer = null;
            console.log(err);
          }, 500);
        });
      } else {
        createBookmark(nodeData).then(() => {
          showFinishMsgPopup.value = true;
          finishMsg.value = '成功';
          setTimeout(() => {
            window.close();
          }, 1000);
        }).catch((err) => {
          showFinishMsgPopup.value = true;
          finishMsg.value = '失败';
          let timer = setTimeout(() => {
            showFinishMsgPopup.value = false;
            timer = null;
            console.log(err);
          }, 500);
        });
      }
    };

    // change page state
    const changePage = inject('changePage');

    return {
      favicon,
      deleteBookmarkHandler,
      showDeleteConfirmModal,
      getDeleteResult,
      title,
      url,
      selectFolder,
      showRecentFolders,
      showCard,
      showSelectFolder,
      showCardHandler,
      setSelectFolderHandler,
      recentFolders,
      share,
      star,
      tags,
      allTags,
      deleteTagsItemHandler,
      groups,
      allGroups,
      deleteGroupsItemHandler,
      description,
      urlBookmarkState,
      finishBookmark,
      finishMsg,
      showFinishMsgPopup,
      changePage,
    };
  },
};
</script>

<style lang="scss" scoped>
.main::-webkit-scrollbar {
  width: 0px;
  height: 0px;
}

.h-center {
  @apply flex justify-center items-center;
}

.btn {
  @apply p-1 text-gray-400 hover:bg-gray-200 hover:text-gray-800 rounded;
}

.framework {
  @apply px-2 py-4 space-y-4 rounded-lg border border-gray-200 border-dashed;
}

.label-style {
  @apply flex items-center text-gray-600 space-x-0.5;
}

.input-style {
  @apply w-full px-2 py-1 text-sm border border-gray-300 rounded;
}

.recent-folders-popup {
  max-height: 5rem;
  overflow-y: overlay;
  &::-webkit-scrollbar {
    width: 5px;
  }
  &::-webkit-scrollbar-thumb {
    border-radius: 2px;
    background-color: #9ca3af;
    // border: 3px solid transparent;
    // background-clip: padding-box;
  }
  &::-webkit-scrollbar-thumb:hover {
    background-color: #4b5563;
  }
}

.select-folders-modal {
  width: 400px;
  height: 560px;
}

.popup-card-enter-from,
.popup-card-leave-to {
  transform: translateY(560px);
}

.popup-card-enter-active {
  transition: transform 350ms ease-in-out;
}

.popup-card-leave-active {
  transition: transform 200ms ease-in-out;
}
</style>
